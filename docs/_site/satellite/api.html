<h1 id="blockstream-satellite-api">Blockstream Satellite API</h1>

<p>Blockstream Satellite API provides developers with an easy-to-use RESTful API that can be used to create applications that broadcast messages globally using the Blockstream Satellite network. Usage of the API is paid for via Lightning micropayments.</p>

<h2 id="private-broadcasts">Private Broadcasts</h2>

<p>Blockstream Satellite broadcasts can offer a high level of privacy through three approaches:</p>
<ul>
  <li>Using Tor to connect to the API can make the source and recipient of broadcasts difficult to determine when inspecting broadcast data.</li>
  <li>Using encryption enables targeted one-to-one and one-to-many communications.</li>
  <li>Privacy of usage payments can be enhanced through the use of the Lightning Network’s onion routing.</li>
</ul>

<p><strong>IMPORTANT</strong> The Blockstream Satellite API is currently operating in developer
mode: utilizing Lightning Testnet for payment and without live satellite
transmissions. We will transition the API to mainnet and live satellite
broadcast on January 16th 2019.</p>

<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-generate-toc again -->

<h2 id="contents">Contents</h2>

<ul>
  <li><a href="#rest-api">REST API</a>
    <ul>
      <li><a href="#post-order">POST /order</a></li>
      <li><a href="#post-orderuuidbump">POST /order/:uuid/bump</a></li>
      <li><a href="#get-orderuuid">GET /order/:uuid</a></li>
      <li><a href="#delete-orderuuid">DELETE /order/:uuid</a></li>
      <li><a href="#get-ordersqueued">GET /orders/queued</a></li>
      <li><a href="#get-orderssent">GET /orders/sent</a></li>
      <li><a href="#get-info">GET /info</a></li>
      <li><a href="#get-subscribechannels">GET /subscribe/:channels</a></li>
    </ul>
  </li>
  <li><a href="#blockstream-satellite-receiver-api-data-output">Blockstream Satellite Receiver API Data Output</a></li>
</ul>

<!-- markdown-toc end -->

<h2 id="rest-api">REST API</h2>

<p>Each call to an API endpoint responds with a JSON object, whether the call is
successful or results in an error.</p>

<p>The code samples below assume that you’ve set <code class="highlighter-rouge">SATELLITE_API</code> in your shell to
<code class="highlighter-rouge">https://satellite.blockstream.com/api</code>, which is the public base URL of your
server. For example, run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export SATELLITE_API=https://satellite.blockstream.com/api
</code></pre></div></div>

<h3 id="post-order">POST /order</h3>

<p>Place an order for a message transmission. The body of the POST must provide a
<code class="highlighter-rouge">file</code> containing the message and a <code class="highlighter-rouge">bid</code> in millisatoshis. If the bid is below
an allowed minimum millisatoshis per byte, an error is returned.</p>

<p>For example, to place an order to transmit the file <code class="highlighter-rouge">hello_world.png</code> with an
initial bid of 10,000 millisatoshi, issue an HTTP POST request like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-F</span> <span class="s2">"bid=10000"</span> <span class="nt">-F</span> <span class="s2">"file=@/path/to/upload/file/hello_world.png"</span> <span class="nv">$SATELLITE_API</span>/order
</code></pre></div></div>

<p>If successful, the response includes the JSON Lightning invoice as returned by
Lightning Charge’s <a href="https://github.com/ElementsProject/lightning-charge#post-invoice">POST
/invoice</a> and
an authentication token that can be used to modify the order. Within the
metadata of the Lightning invoice, metadata is included providing: the bid (in
millisatoshis), the SHA256 digest of the uploaded message file, and a UUID for
the order.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
   <span class="s2">"auth_token"</span>:<span class="s2">"d784e322dad7ec2671086ce3ad94e05108f2501180d8228577fbec4115774750"</span>,
   <span class="s2">"uuid"</span>:<span class="s2">"409348bc-6af0-4999-b715-4136753979df"</span>,
   <span class="s2">"lightning_invoice"</span>:<span class="o">{</span>
      <span class="s2">"id"</span>:<span class="s2">"N0LOTYc9j0gWtQVjVW7pK"</span>,
      <span class="s2">"msatoshi"</span>:<span class="s2">"514200"</span>,
      <span class="s2">"description"</span>:<span class="s2">"BSS Test"</span>,
      <span class="s2">"rhash"</span>:<span class="s2">"5e5c9d111bc76ce4bf9b211f12ca2d9b66b81ae9839b4e530b16cedbef653a3a"</span>,
      <span class="s2">"payreq"</span>:<span class="s2">"lntb5142n1pd78922pp5tewf6ygmcakwf0umyy039j3dndntsxhfswd5u5ctzm8dhmm98gaqdqdgff4xgz5v4ehgxqzjccqp286gfgrcpvzl04sdg2f9sany7ptc5aracnd6kvr2nr0e0x5ajpmfhsjkqzw679ytqgnt6w4490jjrgcvuemz790salqyz9far68cpqtgq3q23el"</span>,
      <span class="s2">"expires_at"</span>:1541642146,
      <span class="s2">"created_at"</span>:1541641546,
      <span class="s2">"metadata"</span>:<span class="o">{</span>
         <span class="s2">"msatoshis_per_byte"</span>:<span class="s2">"200"</span>,
         <span class="s2">"sha256_message_digest"</span>:<span class="s2">"0e2bddf3bba1893b5eef660295ef12d6fc72870da539c328cf24e9e6dbb00f00"</span>,
         <span class="s2">"uuid"</span>:<span class="s2">"409348bc-6af0-4999-b715-4136753979df"</span>
      <span class="o">}</span>,
      <span class="s2">"status"</span>:<span class="s2">"unpaid"</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="post-orderuuidbump">POST /order/:uuid/bump</h3>

<p>Increase the bid for an order sitting in the transmission queue. The
<code class="highlighter-rouge">bid_increase</code> must be provided in the body of the POST. A Lightning invoice is
returned for it and, when it is paid, the increase is added to the current
bid. An <code class="highlighter-rouge">auth_token</code> must also be provided. For example, to increase the bid on
the order placed above by 100,000 millisatoshis, issue a POST like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-v</span> <span class="nt">-F</span> <span class="s2">"bid_increase=100000"</span> <span class="nt">-F</span> <span class="s2">"auth_token=d784e322dad7ec2671086ce3ad94e05108f2501180d8228577fbec4115774750"</span> <span class="nv">$SATELLITE_API</span>/order/409348bc-6af0-4999-b715-4136753979df/bump
</code></pre></div></div>

<p>Response object is in the same format as for <code class="highlighter-rouge">POST /order</code>.</p>

<p>As shown below for DELETE, the <code class="highlighter-rouge">auth_token</code> may alternatively be provided using
the <code class="highlighter-rouge">X-Auth-Token</code> HTTP header.</p>

<h3 id="get-orderuuid">GET /order/:uuid</h3>

<p>Retrieve an order by UUID. Must provide the corresponding auth token to prove
that it is yours.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-v</span> <span class="nt">-H</span> <span class="s2">"X-Auth-Token: 5248b13a722cd9b2e17ed3a2da8f7ac6bd9a8fe7130357615e074596e3d5872f"</span> <span class="nv">$SATELLITE_API</span>/order/409348bc-6af0-4999-b715-4136753979df
</code></pre></div></div>

<h3 id="delete-orderuuid">DELETE /order/:uuid</h3>

<p>To cancel an order, issue an HTTP DELETE request to the API endpoint
<code class="highlighter-rouge">/order/:uuid/</code> providing the UUID of the order. An <code class="highlighter-rouge">auth_token</code> must also be
provided. For example, to cancel the order above, issue a request like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-v</span> <span class="nt">-X</span> DELETE <span class="nt">-F</span> <span class="s2">"auth_token=5248b13a722cd9b2e17ed3a2da8f7ac6bd9a8fe7130357615e074596e3d5872f"</span> <span class="nv">$SATELLITE_API</span>/order/409348bc-6af0-4999-b715-4136753979df
</code></pre></div></div>

<p>The <code class="highlighter-rouge">auth_token</code> may be provided as a parameter in the DELETE body as above or
may be provided using the <code class="highlighter-rouge">X-Auth-Token</code> HTTP header, like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-v</span> <span class="nt">-X</span> DELETE <span class="nt">-H</span> <span class="s2">"X-Auth-Token: 5248b13a722cd9b2e17ed3a2da8f7ac6bd9a8fe7130357615e074596e3d5872f"</span> <span class="nv">$SATELLITE_API</span>/order/409348bc-6af0-4999-b715-4136753979df
</code></pre></div></div>

<h3 id="get-ordersqueued">GET /orders/queued</h3>

<p>Retrieve a list of paid, but unsent orders. Both pending orders and the order
currently being transmitted are returned. Optionally, accepts a parameter
specifying how many queued orders to return.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$SATELLITE_API</span>/orders/queued
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$SATELLITE_API</span>/orders/queued?limit<span class="o">=</span>18
</code></pre></div></div>

<p>The response is a JSON array of records (one for each queued message). The
revealed fields for each record include: <code class="highlighter-rouge">uuid</code>, <code class="highlighter-rouge">bid</code>, <code class="highlighter-rouge">bid_per_byte</code>,
<code class="highlighter-rouge">message_size</code>, <code class="highlighter-rouge">message_digest</code>, <code class="highlighter-rouge">status</code>, <code class="highlighter-rouge">created_at</code>,
<code class="highlighter-rouge">started_transmission_at</code>, and <code class="highlighter-rouge">ended_transmission_at</code>.</p>

<h3 id="get-orderssent">GET /orders/sent</h3>

<p>Retrieves a list of up to 20 sent orders in reverse chronological
order. Optionally, accepts the parameter <code class="highlighter-rouge">before</code> (a timestamp in ISO 8601
format) specifying that only orders before the given time are to be returned.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$SATELLITE_API</span>/orders/sent
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$SATELLITE_API</span>/orders/sent?limit<span class="o">=</span>18
</code></pre></div></div>

<p>The response is a JSON array of records (one for each queued message). The
revealed fields for each record include: <code class="highlighter-rouge">uuid</code>, <code class="highlighter-rouge">bid</code>, <code class="highlighter-rouge">bid_per_byte</code>,
<code class="highlighter-rouge">message_size</code>, <code class="highlighter-rouge">message_digest</code>, <code class="highlighter-rouge">status</code>, <code class="highlighter-rouge">created_at</code>,
<code class="highlighter-rouge">started_transmission_at</code>, and <code class="highlighter-rouge">ended_transmission_at</code>.</p>

<h3 id="get-info">GET /info</h3>

<p>Returns information about the c-lightning node where satellite API payments are
terminated.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$SATELLITE_API</span>/info
</code></pre></div></div>

<p>The response is a JSON object consisting of the node ID, port, IP addresses, and
other information useful for opening payment channels. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
   <span class="s2">"id"</span>:<span class="s2">"032c6ba19a2141c5fee6ac8b6ff6cf24456fd4e8e206716a39af3300876c3a4835"</span>,
   <span class="s2">"port"</span>:42259,
   <span class="s2">"address"</span>:[],
   <span class="s2">"version"</span>:<span class="s2">"v0.5.2-2016-11-21-1937-ge97ee3d"</span>,
   <span class="s2">"blockheight"</span>:434,
   <span class="s2">"network"</span>:<span class="s2">"regtest"</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="get-subscribechannels">GET /subscribe/:channels</h3>

<p>Subscribe to one or more <a href="https://en.wikipedia.org/wiki/Server-sent_events">server-side
events</a> channels. The
<code class="highlighter-rouge">channels</code> parameter is a comma-separated list of event channels. Currently,
only one channel is available: <code class="highlighter-rouge">transmissions</code>, to which an event is pushed each
time a message transmission begins and ends. Event data includes a JSON
representation of the order, including its current status.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nv">$SATELLITE_API</span>/subscribe/:channels
</code></pre></div></div>

<h2 id="blockstream-satellite-receiver-api-data-output">Blockstream Satellite Receiver API Data Output</h2>

<p>The blocksat receiver does not output the raw data payload sent to the Satellite
API directly as it is to the output named pipe. Instead, the blocksat receiver
embeds the data into a structure. The structure contains a delimiter and a field
with the data length. In the end, what appears in the output pipe is as
illustrated below:</p>

<p><img src="../doc/api_output_data_structure.png?raw=true" alt="Output data structure used for API data" title="Output data structure used for API data" /></p>

<p>This structure allows applications to distinguish the boundaries between
independent API transmissions. However, note that it does not guarantee data
integrity, since the length value in the header is simply the length of the
received data, rather than the length of the data that was actually
transmitted. Data integrity is left for the application-specific protocol to be
developed by users. See <a href="examples/#example-1-sending-data-in-a-user-defined-protocol">Example 1 in the “examples”
directory</a> for one
such application-specific protocol that checks data integrity.</p>
